apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "efk-stack.fullname" . }}-test-connection"
  labels:
    {{- include "efk-stack.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    {{- range $serviceName, $service := .Values }}
    {{- if $service.image }}
    - name: "{{ $serviceName }}-test"
      image: busybox
      command:
        - wget
      args:
        - >
          {{ $serviceName }}:{{- if $service.service.port -}}
          {{ $service.service.port }}
          {{- else if $service.service.ports -}}
          {{ (index $service.service.ports 0).containerPort }}
          {{- else -}}
          80
          {{- end }}
    {{- end }}
    {{- end }}
  restartPolicy: Never
